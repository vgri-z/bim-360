<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>垃圾发电</title>
    <link rel="stylesheet" href="./index.css" />
    <link rel="stylesheet" href="./libs/pannellum.min.css" />
    <script type="text/javascript" src="./libs/pannellum.min.js"></script>
    <style></style>
  </head>

  <body ondragstart="return false">
    <div id="panorama"></div>

    <div class="navs">
      <div class="nav left active">
        卸料大厅
        <ul class="items">
          <li class="item">坑圾坑 <img class="warn-img" src="./assets/warn2.png" alt="" /></li>
          <li class="item">垃圾吊抓斗 <img class="warn-img" src="./assets/warn2.png" alt="" /></li>
          <li class="item">垃圾运输车 <img class="warn-img" src="./assets/warn2.png" alt="" /></li>
          <li class="item">进出卷帘门 <img class="warn-img" src="./assets/warn2.png" alt="" /></li>
          <li class="item">卸料大厅 <img class="warn-img" src="./assets/warn2.png" alt="" /></li>
          <li class="item">卸料门 <img class="warn-img" src="./assets/warn2.png" alt="" /></li>
        </ul>
        <img class="arrow-img" src="./assets/arrow_down.png" alt="" />
      </div>
    </div>

    <div id="dialog">
      <img class="close" onclick="closeDialog()" src="./assets/close.png" alt="" />
      <!-- <img class="content-img" src="./assets/xieliao-warn.png" alt="" /> -->
      <div class="content">
        <div class="item warn-images">
          <h3 class="title">告示牌(12张)</h3>
          <div class="list">
            <ul>
              <li class="list-item"><img src="./assets/warn3.png" alt="" /> 这是一个告示牌</li>
              <li class="list-item"><img src="./assets/warn3.png" alt="" /> 这是一个告示牌</li>
              <li class="list-item"><img src="./assets/warn3.png" alt="" /> 这是一个告示牌</li>
              <li class="list-item"><img src="./assets/warn3.png" alt="" /> 这是一个告示牌</li>
              <li class="list-item"><img src="./assets/warn3.png" alt="" /> 这是一个告示牌</li>
              <li class="list-item"><img src="./assets/warn3.png" alt="" /> 这是一个告示牌</li>
              <li class="list-item"><img src="./assets/warn3.png" alt="" /> 这是一个告示牌</li>
              <li class="list-item"><img src="./assets/warn3.png" alt="" /> 这是一个告示牌</li>
              <li class="list-item"><img src="./assets/warn3.png" alt="" /> 这是一个告示牌</li>
              <li class="list-item"><img src="./assets/warn3.png" alt="" /> 这是一个告示牌</li>
              <li class="list-item"><img src="./assets/warn3.png" alt="" /> 这是一个告示牌</li>
              <li class="list-item"><img src="./assets/warn3.png" alt="" /> 这是一个告示牌</li>
              <li class="list-item"><img src="./assets/warn3.png" alt="" /> 这是一个告示牌</li>
              <li class="list-item"><img src="./assets/warn3.png" alt="" /> 这是一个告示牌</li>
            </ul>
          </div>
        </div>
        <div class="item videos">
          <h3 class="title">安全事故(38件)</h3>
          <div class="list">
            <ul>
              <li class="list-item">
                <video src="./assets/video.mp4"></video>
              </li>
              <li class="list-item">
                <video src="./assets/video.mp4"></video>
              </li>
              <li class="list-item">
                <video src="./assets/video.mp4"></video>
              </li>
            </ul>
          </div>
        </div>
        <div class="item files">
          <h3 class="title">案例文件(8份)</h3>
          <div class="list">
            <ul>
              <li class="list-item"><img src="./assets/pdf-icon.png" alt="" /> 这是一份案例文件</li>
              <li class="list-item"><img src="./assets/pdf-icon.png" alt="" /> 这是一份案例文件</li>
              <li class="list-item"><img src="./assets/pdf-icon.png" alt="" /> 这是一份案例文件</li>
              <li class="list-item"><img src="./assets/pdf-icon.png" alt="" /> 这是一份案例文件</li>
              <li class="list-item"><img src="./assets/pdf-icon.png" alt="" /> 这是一份案例文件</li>
              <li class="list-item"><img src="./assets/pdf-icon.png" alt="" /> 这是一份案例文件</li>
              <li class="list-item"><img src="./assets/pdf-icon.png" alt="" /> 这是一份案例文件</li>
              <li class="list-item"><img src="./assets/pdf-icon.png" alt="" /> 这是一份案例文件</li>
              <li class="list-item"><img src="./assets/pdf-icon.png" alt="" /> 这是一份案例文件</li>
              <li class="list-item"><img src="./assets/pdf-icon.png" alt="" /> 这是一份案例文件</li>
              <li class="list-item"><img src="./assets/pdf-icon.png" alt="" /> 这是一份案例文件</li>
              <li class="list-item"><img src="./assets/pdf-icon.png" alt="" /> 这是一份案例文件</li>
              <li class="list-item"><img src="./assets/pdf-icon.png" alt="" /> 这是一份案例文件</li>
              <li class="list-item"><img src="./assets/pdf-icon.png" alt="" /> 这是一份案例文件</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <script>
      let num = 0;
      const hotspot = (hotSpotDom, args) => {
        num++;
        const data = args;

        hotSpotDom.classList.add(data.cssClass);
        hotSpotDom.id = data.id;
        hotSpotDom.setAttribute("data-url", data.imgUrl);
        hotSpotDom.setAttribute("data-scale", "scale");
        if (num === 5) {
          setIconScale();
        }
      };

      pannellum.viewer("panorama", {
        type: "equirectangular",
        panorama: "./assets/360.png",
        autoLoad: true,
        autoRotate: 0, // 为0停止自动旋转
        stopAutoRotate: true,
        hotSpots: [
          {
            pitch: 12,
            yaw: 38,
            cssClass: "hotspot",
            createTooltipFunc: hotspot,
            createTooltipArgs: {
              id: "bubble1",
              title: "卸料口",
              cssClass: "tooltip",
              imgUrl: "./assets/xieliao-warn.png",
            },
          },
          {
            pitch: 9,
            yaw: 94,
            cssClass: "hotspot",
            createTooltipFunc: hotspot,
            createTooltipArgs: {
              id: "bubble2",
              title: "安全警示",
              cssClass: "tooltip",
              imgUrl: "./assets/ydqt-warn.png",
            },
          },
          {
            pitch: 11,
            yaw: 274,
            cssClass: "hotspot",
            createTooltipFunc: hotspot,
            createTooltipArgs: {
              id: "bubble3",
              title: "墙",
              cssClass: "tooltip",
              imgUrl: "./assets/ydqt-warn.png",
            },
          },
          {
            pitch: 6,
            yaw: 320,
            cssClass: "hotspot",
            createTooltipFunc: hotspot,
            createTooltipArgs: {
              id: "bubble4",
              title: "维修车间",
              cssClass: "tooltip",
              imgUrl: "./assets/ljdz-warn.png",
            },
          },
          {
            pitch: 16,
            yaw: 383,
            cssClass: "hotspot",
            createTooltipFunc: hotspot,
            createTooltipArgs: {
              id: "bubble5",
              title: "卸料门",
              cssClass: "tooltip",
              imgUrl: "./assets/xlmzh-warn.png",
            },
          },
        ],
      });

      function setIconScale() {
        const hotSpotDoms = document.getElementsByClassName("hotspot");
        Array.from(hotSpotDoms).forEach((item, index) => {
          setInterval(() => {
            let flag = item.getAttribute("data-flag");
            if (flag === "scale") {
              item.style.width = "50px";
              item.style.height = "50px";
              item.style.backgroundColor = "rgba(0, 0, 0, 0.8)";
              hotSpotDoms[index].setAttribute("data-flag", "");
            } else {
              item.style.width = "55px";
              item.style.height = "55px";
              item.style.backgroundColor = "rgba(0, 0, 0, 0.2)";
              hotSpotDoms[index].setAttribute("data-flag", "scale");
            }
          }, 1000);
        });
      }

      const dialogEl = document.getElementById("dialog");
      document.getElementById("panorama").addEventListener("click", function (e) {
        const target = e.target;
        // dialogEl.style.left = "500px";
        // dialogEl.style.top = "200px";
        console.log(target);
        if (Array.from(target.classList).indexOf("hotspot") !== -1) {
          dialogEl.style.display = "block";
          const imgUrl = target.getAttribute("data-url");
          const imgEl = dialogEl.getElementsByClassName("content-img")[0];
          imgEl.setAttribute("src", imgUrl);
        }
      });

      // 关闭弹窗
      function closeDialog() {
        dialogEl.style.display = "none";
      }

      const navsEl = document.getElementsByClassName("navs")[0];
      const navItemEl = navsEl.getElementsByClassName("nav")[0];
      const menuItemEls = navsEl.getElementsByClassName("item");
      let flag = true;
      navItemEl.addEventListener("click", function () {
        const imgEl = this.getElementsByClassName("arrow-img")[0];
        if (flag) {
          imgEl.setAttribute("src", "./assets/arrow_up.png");
          this.style.backgroundImage = 'url("./assets/menu_active.png")';
          const menuEL = this.getElementsByClassName("items")[0];
          menuEL.style.display = "block";
          flag = false;
        } else {
          imgEl.setAttribute("src", "./assets/arrow_down.png");
          this.style.backgroundImage = 'url("./assets/menu_item.png")';
          const menuEL = this.getElementsByClassName("items")[0];
          menuEL.style.display = "none";
          flag = true;
        }
      });

      Array.from(menuItemEls).forEach((item, index) => {
        const imgEl = item.getElementsByClassName("warn-img")[0];
        item.addEventListener("click", function (e) {
          e.stopPropagation();
          // dialogEl.style.display = "none";
        });
        item.addEventListener("mouseenter", function (e) {
          if (imgEl) {
            imgEl.setAttribute("src", "./assets/warn1.png");
          }
        });
        item.addEventListener("mouseleave", function (e) {
          if (imgEl) {
            imgEl.setAttribute("src", "./assets/warn2.png");
          }
        });
      });

      // 弹窗拖拽
      // let disX, disY;
      // dialogEl.onmousedown = function (e) {
      //   disX = e.pageX - parseInt(dialogEl.style.left);
      //   disY = e.pageY - parseInt(dialogEl.style.top);

      //   document.onmousemove = function (e) {
      //     dialogEl.style.left = e.pageX - disX + "px";
      //     dialogEl.style.top = e.pageY - disY + "px";
      //   };

      //   document.onmouseup = function (e) {
      //     document.onmousemove = null;
      //   };
      // };
    </script>
  </body>
</html>
